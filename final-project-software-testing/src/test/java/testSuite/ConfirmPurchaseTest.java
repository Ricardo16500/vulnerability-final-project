package testSuite;



import dev.failsafe.internal.util.Assert;
import org.example.classes.ProductList;
import org.example.classes.User;
import org.example.pages.*;

import org.junit.jupiter.api.AfterEach;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Order;
import org.junit.jupiter.api.Test;


import org.example.session.Session;


public class ConfirmPurchaseTest  {
    @BeforeEach
    public void openBrowser() {

        Session.getSession().getBrowser();
    }



    @Test
    @Order(1)
    public void confirmPurchaseTest() throws InterruptedException {
        MainPage mainPage = new MainPage();
        LoginPage loginPage = new LoginPage();
        User user = new User();
        mainPage.clickLoginButton();

        loginPage.clickOnEmailLoginBtn();
        loginPage.enterUserEmail(user.getEmail());
        loginPage.enterUserPassword(user.getPassword());
        loginPage.clickOnLoginBtn();
        Thread.sleep(3000);

        ProductList productList = new ProductList();

        MenProductsPage menProductsPage = new MenProductsPage();
        ProductAddToCartPage productAddToCartPage = new ProductAddToCartPage();
        WomenProductsPage womenProductsPage = new WomenProductsPage();
        CartPage cartPage = new CartPage();

        for (int i= 0; i < 4; i++) {
            mainPage.clickManCategory();
            try {
                Thread.sleep(7000);
                menProductsPage.clickOnProduct(productList.getMenProduct(i));
                productAddToCartPage.scrollToVerticalPosition(Session.getSession().getBrowser());
                Thread.sleep(3000);
                productAddToCartPage.clickOnAddToCartButton();
                Thread.sleep(3000);
                cartPage.clickOnCloseButton();
            }catch (Exception e){
                System.out.println("ERROR> no se pudo agregar el producto");
            }
        }
        for (int i = 0; i < 4; i++) {
            mainPage.clickWomenCategory();
            try {
                Thread.sleep(7000);
                menProductsPage.clickOnProduct(productList.getWomenProduct(i));
                productAddToCartPage.scrollToVerticalPosition(Session.getSession().getBrowser());
                Thread.sleep(3000);
                productAddToCartPage.clickOnAddToCartButton();
                Thread.sleep(3000);
                cartPage.clickOnCloseButton();
            }catch (Exception e){
                System.out.println("ERROR> no se pudo agregar el producto");
            }
        }

        CheckoutPage checkoutPage = new CheckoutPage();
        PurchasePage purchasePage = new PurchasePage();


        mainPage.clickShoppingCartButton();
        Thread.sleep(3000);
        cartPage.clickOnCheckoutButton();
        String totalPrice = checkoutPage.getTotalPrice();
        System.out.println(totalPrice);
        checkoutPage.clickOnFinishButton();
        Assert.isTrue(purchasePage.titleDisplayed(),"ERROR> no se desplego el titulo");


    }


    @AfterEach
    public void closeBrowser(){
        Session.getSession().getBrowser().quit();
    }
}
